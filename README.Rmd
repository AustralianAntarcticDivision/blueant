---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  ##comment = "#>",
  fig.path = "README-"
)
```

[![Travis-CI Build Status](https://travis-ci.org/AustralianAntarcticDivision/blueant.svg?branch=master)](https://travis-ci.org/AustralianAntarcticDivision/blueant)
[![AppVeyor Build status](https://ci.appveyor.com/api/projects/status/5idrimyx0uuv6liu?svg=true)](https://ci.appveyor.com/project/raymondben/blueant)
[![codecov](https://codecov.io/gh/AustralianAntarcticDivision/blueant/branch/master/graph/badge.svg)](https://codecov.io/gh/AustralianAntarcticDivision/blueant)

# Blueant

Blueant provides a set of data source configurations to use with the [bowerbird](https://github.com/AustralianAntarcticDivision/bowerbird) package. These packages will allow you to download data from external data providers to your local file system, and to keep that data collection up to date.

## Installing

```{r eval=FALSE}
install.packages("devtools")
library(devtools)
install_github("AustralianAntarcticDivision/blueant",build_vignettes=TRUE)
```

Bowerbird (and by extension, blueant) use the third-party utility `wget` to do the heavy lifting of recursively downloading files from data providers. `wget` is typically installed by default on Linux.
On Windows you can use the `install_wget()` function to install it. Otherwise download `wget` yourself (e.g. from https://eternallybored.org/misc/wget/current/wget.exe) and make sure it is on your path.

## Usage

### Configuration

Build up a configuration by first defining global options such as the destination on your local file system:

```{r eval=FALSE}
cf <- bb_config(local_file_root="~/your/data/directory")
```

Add data sources from those provided by blueant. A summary of these sources is given at the end of this document.

```{r eval=FALSE}
cf <- cf %>% add(blueant_sources("CERSAT SSM/I sea ice concentration"))
```

### Synchronisation

Once the configuration has been defined, run the sync process:

```{r eval=FALSE}
bb_sync(cf)
```

Congratulations! You now have your own local copy of your chosen data sets.

The pre-packaged environmental data sources can be read, manipulated, and plotted using a range of other R packages, including [RAADTools](https://github.com/AustralianAntarcticDivision/raadtools) and [raster](https://cran.r-project.org/package=raster).


## Nuances

### Choosing a data directory

It's up to you where you want your data collection kept, and to provide that location to bowerbird. A common use case for bowerbird is maintaining a central data collection for multiple users, in which case that location is likely to be some sort of networked file share. However, if you are keeping a collection for your own use, you might like to look at https://github.com/r-lib/rappdirs to help find a suitable directory location.

### Modifying data sources

#### Authentication

Some data providers require users to log in. These are indicated by the `authentication_note` column in the configuration table. For these sources, you will need to provide your user name and password, e.g.:

```{r eval=FALSE}
src <- blueant_sources(name="CMEMS global gridded SSH reprocessed (1993-ongoing)")
src$user <- "yourusername"
src$password <- "yourpassword"
cf <- add(cf,src)

## or, using dplyr
cf <- cf %>% add(blueant_sources(name="CMEMS global gridded SSH reprocessed (1993-ongoing)") %>%
                 mutate(user="yourusername",password="yourpassword"))
```

#### Reducing download sizes

Sometimes you might only want part of a pre-configured data source. If the data source uses the `bb_wget` method, you can restrict what is downloaded by modifying the data source's `method_flags`, particularly the `--accept`, `--reject`, `--accept-regex`, and `--reject-regex` options. Be sure to leave the original method flags in place, unless you know what you are doing.

For example, the CERSAT SSM/I sea ice concentration data are arranged in yearly directories, so it is fairly easy to restrict ourselves to, say, only the 2017 data:

```{r eval=FALSE}
cf <- cf %>% add(blueant_sources("CERSAT SSM/I sea ice concentration") %>%
                 mutate(method_flags=paste(method_flags,"--accept-regex=\"/2017/\"")))
```

See the bowerbird documentation for further guidances on the accept/reject flags.

Alternatively, for data sources that are divided into subdirectories, one could replace the whole-data-source `source_url` with one or more that point to specific yearly (or other) subdirectories. For example, the default `source_url` for the CERSAT sea ice data above is "ftp://ftp.ifremer.fr/ifremer/cersat/products/gridded/psi-concentration/data/antarctic/daily/netcdf/*" (with yearly subdirectories). So e.g. for 2016 and 2017 data we could do:

```{r eval=FALSE}
cf <- cf %>% add(blueant_sources("CERSAT SSM/I sea ice concentration") %>%
    mutate(source_url=c("ftp://ftp.ifremer.fr/ifremer/cersat/products/gridded/psi-concentration/data/antarctic/daily/netcdf/2016/*",
                        "ftp://ftp.ifremer.fr/ifremer/cersat/products/gridded/psi-concentration/data/antarctic/daily/netcdf/2017/*")))
```

### Defining new data sources

If the pre-packages data sources don't cover your needs, you can define your own using the `bb_source` function. See the bowerbird documentation.

## Data source summary

These are the data source definitions that are provided as part of the blueant package.

```{r echo=FALSE,message=FALSE,warning=FALSE,results="asis"}
devtools::load_all()
cf <- bb_config("/your/data/root/") %>% add(blueant_sources())
sf <- bb_summary(cf,format="rmd",inc_license=FALSE,inc_access_function=FALSE,inc_path=FALSE)
stxt <- readLines(sf)
stxt <- stxt[(grep("Last updated:",stxt)+1):length(stxt)]
stxt <- gsub("^#","##",stxt) ## push each header level down one
stxt <- gsub("^\\-","\n-",stxt)
for (k in stxt) cat(k,"\n")
```
